<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>api/index.html</title>
  </head>
  <body id="show">
    <script>
      "use strict"
      function makePage(aryData) {
        // [{id : ?, first_name : ?, last_name : ?, email : ?, gender : ?}]
        // > table 형식
        // table > thead > tbody > tr > th, td
        let table = document.createElement("table")
        table.setAttribute("border", "1")

        let thead = document.createElement("thead")

        // <tbody></tbody>
        let tbody = document.createElement("tbody")
        aryData.forEach(function (obj) {
          let tr = document.createElement("tr")
          aryData.forEach(function (field) {
            let td = document.createElement("td")
            let text = document.createTextNode(field[obj])
            td.append(text)
            tr.append(td)
          })
          tbody.append(tr)
        })
        table.append(thead, tbody)
        document.getElementById("show").append(table)
      }

      //   let ul = document.createElement("ul")
      //   aryData.forEach(function (item) {
      //     let li = document.createElement("li")
      //     let text = document.createTextNode(
      //       `${item.id} - ${item.first_name} - ${item.last_name}`
      //     )
      //     li.appendChild(text)
      //     ul.appendChild(li)
      //   })
      //   console.log(ul)
      //   document.getElementsByTagName("body")[0].appendChild(ul)
      // }

      const fields = [
        "id",
        "centerName",
        "address",
        "phoneNumber",
        "sido",
        "sigungu",
      ]
      function showCenterList(data) {
        // 전체 카운트 : data.currentCount : 284
        // 현재 페이지 : data.page : 1
        // 전체 데이터 : data.data : 284건의 접종센터 정보

        let table = document.createElement("table")
        table.setAttribute("border", "1")
        table.setAttribute("id", "tbl")
        let thead = document.createElement("thead")
        let tbody = document.createElement("tbody")

        // table의 하위요소로 thead, tbody 추가
        table.append(thead, tbody)

        // thead 작성
        let tr = document.createElement("tr")
        fields.forEach(function (field) {
          let td = document.createElement("th")
          let text = document.createTextNode(field.toUpperCase())
          td.append(text)
          tr.append(td)
        })
        thead.append(tr)

        // tbody 작성
        data.data.forEach(function (item) {
          let tr = document.createElement("tr")
          fields.forEach(function (field) {
            let td = document.createElement("td")
            let text = document.createTextNode(item[field])
            td.append(text)
            tr.append(td)
          })
          tbody.append(tr)
        })

        document.getElementById("show").append(table)
      }

      // Asynchoronous Javascript And Xml(ajax)
      // perPage = 가져올 데이터 건 수
      let url = `https://api.odcloud.kr/api/15077586/v1/centers?page=1&perPage=284&returnType=JSON&serviceKey=N%2FyDCz6DnRrV45AM81yqvJ9T0C1jPO6x8V8bh1ZUPRwTHQg9C%2B3vOgc6%2FtZcvfaQAwypSKSxXNUW2cpmJBqoZA%3D%3D`
      let xhtp = new XMLHttpRequest()
      xhtp.onreadystatechange = function () {
        //readyState 1, 2, 3은 준비중을 뜻함
        if (xhtp.readyState == 4 && xhtp.status == 200) {
          console.log("readyState : " + xhtp.readyState)
          console.log("status : " + xhtp.status)
          let data = JSON.parse(xhtp.responseText)
          console.log(data)

          makePage(data)
          //   showCenterList(data)
        }
      }
      xhtp.open("get", url)
      xhtp.send()
    </script>
  </body>
</html>
